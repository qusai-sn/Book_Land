<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta charset="utf-8" />
  <title>AI Chat Example</title>
  <script src="js/test.js"></script>
  <style>
    .chat-container {
      width: 300px;
      border: 1px solid #ccc;
      padding: 10px;
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #fff;
    }

    .chat-header {
      font-weight: bold;
      margin-bottom: 10px;
    }

    .chat-messages {
      height: 200px;
      overflow-y: auto;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      padding: 5px;
    }

    input[type="text"] {
      width: 70%;
    }

    button {
      padding: 5px 10px;
    }
  </style>
</head>

<body>
  <div id="chatbox" class="chat-container">
    <div class="chat-header">
      <h4>Chat with us</h4>
      <button id="closeChat">X</button>
    </div>
    <div id="chatMessages" class="chat-messages">
      <!-- Chat messages will appear here -->
    </div>
    <input type="text" id="userInput" placeholder="Type your message..." />
    <button id="sendMessage">Send</button>
  </div>

  <div id="div"></div>

  <script>
    const apiRateLimit = 5; // adjust this value based on your plan
    const apiRateLimitInterval = 60 * 1000; // 1 minute
    let lastApiRequest = 0;
    const chatMessages = document.getElementById("chatMessages");
    const userInput = document.getElementById("userInput");

    document.getElementById("sendMessage").addEventListener("click", async () => {
      const userInputValue = userInput.value.trim();

      if (userInputValue === "") {
        alert("Please enter a message.");
        return;
      }

      if (Date.now() - lastApiRequest < apiRateLimitInterval) {
        alert("Rate limit exceeded. Please try again later.");
        return;
      }

      lastApiRequest = Date.now();

      try {
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer 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' // replace with your API key
          },
          body: JSON.stringify({
            "model": "text-davinci-003",
            "prompt": userInputValue,
            "temperature": 0.5,
            "max_tokens": 100
          })
        });

        const responseData = await response.json();
        const aiResponse = responseData.choices[0].text;

        chatMessages.innerHTML += `<p>You: ${userInputValue}</p>`;
        chatMessages.innerHTML += `<p>AI: ${aiResponse}</p>`;
        userInput.value = "";

      } catch (error) {
        console.error('Error fetching AI response:', error);
        chatMessages.innerHTML += `<p>Error: ${error.message}</p>`;
      }
    });
  </script>
</body>

</html>